<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="doc2go">
    <link href="../../../../_/css/main.css" rel="stylesheet" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../_/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../_/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../_/icons/favicon-16x16.png">
    <link rel="shortcut icon" href="../../../../_/icons/favicon.ico"><title>web</title>
</head>
  <body>
    <nav>
        <a href="../../..">go.astrophena.name</a>/<a href="../..">tools</a>/<a href="..">internal</a>/web<span class="navbar-right">
          <a href="../../../..">Root</a> | <a href="#pkg-index">Index</a></span>
      </nav>
    <main><h2 id="pkg-overview">package web</h2>
<pre class="chroma"><span class="kn">import</span> <span class="s">&#34;go.astrophena.name/tools/internal/web&#34;</span></pre>
<p>Package web is a collection of functions and types for building web services.
<h3 id="pkg-index">Index</h3>
<ul>
  <li><a href="#BadRequest">func BadRequest(w http.ResponseWriter, r *http.Request, message string)</a></li>
  <li><a href="#Conns">func Conns(logf logger.Logf, s *http.Server) (http.Handler, func(proxyAddr, realAddr string))</a></li>
  <li><a href="#Error">func Error(logf logger.Logf, w http.ResponseWriter, r *http.Request, err error)</a></li>
  <li><a href="#ListenAndServe">func ListenAndServe(ctx context.Context, c *ListenAndServeConfig) error</a></li>
  <li><a href="#NotFound">func NotFound(w http.ResponseWriter, r *http.Request)</a></li>
  <li>
      <a href="#CheckResponse">type CheckResponse</a>
      </li>
  <li>
      <a href="#DebugHandler">type DebugHandler</a>
      <ul>
          <li><a href="#Debugger">func Debugger(logf logger.Logf, mux *http.ServeMux) *DebugHandler</a></li>
          <li><a href="#DebugHandler.Handle">func (d *DebugHandler) Handle(slug, desc string, handler http.Handler)</a></li>
          <li><a href="#DebugHandler.KV">func (d *DebugHandler) KV(k string, v any)</a></li>
          <li><a href="#DebugHandler.KVFunc">func (d *DebugHandler) KVFunc(k string, v func() any)</a></li>
          <li><a href="#DebugHandler.Link">func (d *DebugHandler) Link(url, desc string)</a></li>
          <li><a href="#DebugHandler.ServeHTTP">func (d *DebugHandler) ServeHTTP(w http.ResponseWriter, r *http.Request)</a></li>
          <li><a href="#DebugHandler.SetIcon">func (d *DebugHandler) SetIcon(b []byte)</a></li>
          </ul>
      </li>
  <li>
      <a href="#HealthFunc">type HealthFunc</a>
      </li>
  <li>
      <a href="#HealthHandler">type HealthHandler</a>
      <ul>
          <li><a href="#Health">func Health(mux *http.ServeMux) *HealthHandler</a></li>
          <li><a href="#HealthHandler.RegisterFunc">func (h *HealthHandler) RegisterFunc(name string, f HealthFunc)</a></li>
          <li><a href="#HealthHandler.ServeHTTP">func (h *HealthHandler) ServeHTTP(w http.ResponseWriter, r *http.Request)</a></li>
          </ul>
      </li>
  <li>
      <a href="#HealthResponse">type HealthResponse</a>
      </li>
  <li>
      <a href="#ListenAndServeConfig">type ListenAndServeConfig</a>
      </li>
  </ul><h3 id="pkg-functions">Functions</h3>
  <h3 id="BadRequest">func BadRequest</h3>
    <pre class="chroma"><span class="kd">func</span> <span class="nf">BadRequest</span><span class="p">(</span><span class="nx">w</span> <a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#ResponseWriter"><span class="nx">ResponseWriter</span></a><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#Request"><span class="nx">Request</span></a><span class="p">,</span> <span class="nx">message</span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a><span class="p">)</span></pre>
    <p>BadRequest replies to the request with an HTTP 400 bad request error.
<h3 id="Conns">func Conns</h3>
    <pre class="chroma"><span class="kd">func</span> <span class="nf">Conns</span><span class="p">(</span><span class="nx">logf</span> <a href="../logger"><span class="nx">logger</span></a><span class="p">.</span><a href="../logger#Logf"><span class="nx">Logf</span></a><span class="p">,</span> <span class="nx">s</span> <span class="o">*</span><a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#Server"><span class="nx">Server</span></a><span class="p">)</span> <span class="p">(</span><a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#Handler"><span class="nx">Handler</span></a><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">proxyAddr</span><span class="p">,</span> <span class="nx">realAddr</span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a><span class="p">))</span></pre>
    <p>Conns returns an http.Handler that displays the list of active
HTTP connections and associates it with the provided http.Server.
<h3 id="Error">func Error</h3>
    <pre class="chroma"><span class="kd">func</span> <span class="nf">Error</span><span class="p">(</span><span class="nx">logf</span> <a href="../logger"><span class="nx">logger</span></a><span class="p">.</span><a href="../logger#Logf"><span class="nx">Logf</span></a><span class="p">,</span> <span class="nx">w</span> <a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#ResponseWriter"><span class="nx">ResponseWriter</span></a><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#Request"><span class="nx">Request</span></a><span class="p">,</span> <span class="nx">err</span> <a href="https://pkg.go.dev/builtin#error"><span class="kt">error</span></a><span class="p">)</span></pre>
    <p>Error replies to the request with an HTTP 500 internal server error and logs
the error using provided logf.
<h3 id="ListenAndServe">func ListenAndServe</h3>
    <pre class="chroma"><span class="kd">func</span> <span class="nf">ListenAndServe</span><span class="p">(</span><span class="nx">ctx</span> <a href="https://pkg.go.dev/context"><span class="nx">context</span></a><span class="p">.</span><a href="https://pkg.go.dev/context#Context"><span class="nx">Context</span></a><span class="p">,</span> <span class="nx">c</span> <span class="o">*</span><a href="#ListenAndServeConfig"><span class="nx">ListenAndServeConfig</span></a><span class="p">)</span> <a href="https://pkg.go.dev/builtin#error"><span class="kt">error</span></a></pre>
    <p>ListenAndServe starts the HTTP server based on the provided
ListenAndServeConfig.
<h3 id="NotFound">func NotFound</h3>
    <pre class="chroma"><span class="kd">func</span> <span class="nf">NotFound</span><span class="p">(</span><span class="nx">w</span> <a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#ResponseWriter"><span class="nx">ResponseWriter</span></a><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#Request"><span class="nx">Request</span></a><span class="p">)</span></pre>
    <p>NotFound replies to the request with an HTTP 404 not found error.
<h3 id="pkg-types">Types</h3>
  <h3 id="CheckResponse">type CheckResponse</h3>
    <pre class="chroma"><span class="kd">type</span> <span class="nx">CheckResponse</span> <span class="kd">struct</span> <span class="p">{</span>
	<span id="CheckResponse.Status"><span class="nx">Status</span></span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a> <span class="s">`json:&#34;status&#34;`</span>
	<span id="CheckResponse.OK"><span class="nx">OK</span></span>     <a href="https://pkg.go.dev/builtin#bool"><span class="kt">bool</span></a>   <span class="s">`json:&#34;ok&#34;`</span>
<span class="p">}</span></pre>
    <p>Types used in JSON responses.
<h3 id="DebugHandler">type DebugHandler</h3>
    <pre class="chroma"><span class="kd">type</span> <span class="nx">DebugHandler</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// contains filtered or unexported fields
</span><span class="c1"></span><span class="p">}</span></pre>
    <p>DebugHandler is an http.Handler that serves a debugging &quot;homepage&quot;, and
provides helpers to register more debug endpoints and reports.
<p>The rendered page consists of two sections: informational key/value pairs and
links to other pages.
<p>Callers can add to these sections using the KV and URL helpers respectively.
<p>Additionally, the Handle method offers a shorthand for correctly registering
debug handlers and cross-linking them from /debug/.
<h4 id="Debugger">func Debugger</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="nf">Debugger</span><span class="p">(</span><span class="nx">logf</span> <a href="../logger"><span class="nx">logger</span></a><span class="p">.</span><a href="../logger#Logf"><span class="nx">Logf</span></a><span class="p">,</span> <span class="nx">mux</span> <span class="o">*</span><a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#ServeMux"><span class="nx">ServeMux</span></a><span class="p">)</span> <span class="o">*</span><a href="#DebugHandler"><span class="nx">DebugHandler</span></a></pre>
  <p>Debugger returns the DebugHandler registered on mux at /debug/, creating it
if necessary.
<h4 id="DebugHandler.Handle">func (*DebugHandler) Handle</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><a href="#DebugHandler"><span class="nx">DebugHandler</span></a><span class="p">)</span> <span class="nf">Handle</span><span class="p">(</span><span class="nx">slug</span><span class="p">,</span> <span class="nx">desc</span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a><span class="p">,</span> <span class="nx">handler</span> <a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#Handler"><span class="nx">Handler</span></a><span class="p">)</span></pre>
  <p>Handle registers handler at /debug/&lt;slug&gt; and creates a descriptive
entry in /debug/ for it.
<h4 id="DebugHandler.KV">func (*DebugHandler) KV</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><a href="#DebugHandler"><span class="nx">DebugHandler</span></a><span class="p">)</span> <span class="nf">KV</span><span class="p">(</span><span class="nx">k</span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a><span class="p">,</span> <span class="nx">v</span> <a href="https://pkg.go.dev/builtin#any"><span class="nx">any</span></a><span class="p">)</span></pre>
  <p>KV adds a key/value list item to /debug/.
<h4 id="DebugHandler.KVFunc">func (*DebugHandler) KVFunc</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><a href="#DebugHandler"><span class="nx">DebugHandler</span></a><span class="p">)</span> <span class="nf">KVFunc</span><span class="p">(</span><span class="nx">k</span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a><span class="p">,</span> <span class="nx">v</span> <span class="kd">func</span><span class="p">()</span> <a href="https://pkg.go.dev/builtin#any"><span class="nx">any</span></a><span class="p">)</span></pre>
  <p>KVFunc adds a key/value list item to /debug/. v is called on every
render of /debug/.
<h4 id="DebugHandler.Link">func (*DebugHandler) Link</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><a href="#DebugHandler"><span class="nx">DebugHandler</span></a><span class="p">)</span> <span class="nf">Link</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">desc</span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a><span class="p">)</span></pre>
  <p>Link adds a URL and description list item to /debug/.
<h4 id="DebugHandler.ServeHTTP">func (*DebugHandler) ServeHTTP</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><a href="#DebugHandler"><span class="nx">DebugHandler</span></a><span class="p">)</span> <span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">w</span> <a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#ResponseWriter"><span class="nx">ResponseWriter</span></a><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#Request"><span class="nx">Request</span></a><span class="p">)</span></pre>
  <p>ServeHTTP implements the http.Handler.
<h4 id="DebugHandler.SetIcon">func (*DebugHandler) SetIcon</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">d</span> <span class="o">*</span><a href="#DebugHandler"><span class="nx">DebugHandler</span></a><span class="p">)</span> <span class="nf">SetIcon</span><span class="p">(</span><span class="nx">b</span> <span class="p">[]</span><a href="https://pkg.go.dev/builtin#byte"><span class="kt">byte</span></a><span class="p">)</span></pre>
  <p>SetIcon sets the debug web page icon, should be in JPEG format.
<h3 id="HealthFunc">type HealthFunc</h3>
    <pre class="chroma"><span class="kd">type</span> <span class="nx">HealthFunc</span> <span class="kd">func</span><span class="p">()</span> <span class="p">(</span><span class="nx">status</span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a><span class="p">,</span> <span class="nx">ok</span> <a href="https://pkg.go.dev/builtin#bool"><span class="kt">bool</span></a><span class="p">)</span></pre>
    <p>HealthFunc is the health check function that reports the state of a
particular subsystem.
<h3 id="HealthHandler">type HealthHandler</h3>
    <pre class="chroma"><span class="kd">type</span> <span class="nx">HealthHandler</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// contains filtered or unexported fields
</span><span class="c1"></span><span class="p">}</span></pre>
    <p>HealthHandler is an HTTP handler that returns information about the health
status of the running service.
<h4 id="Health">func Health</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="nf">Health</span><span class="p">(</span><span class="nx">mux</span> <span class="o">*</span><a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#ServeMux"><span class="nx">ServeMux</span></a><span class="p">)</span> <span class="o">*</span><a href="#HealthHandler"><span class="nx">HealthHandler</span></a></pre>
  <p>Health returns the HealthHandler registered on mux at /health, creating it
if necessary.
<h4 id="HealthHandler.RegisterFunc">func (*HealthHandler) RegisterFunc</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">h</span> <span class="o">*</span><a href="#HealthHandler"><span class="nx">HealthHandler</span></a><span class="p">)</span> <span class="nf">RegisterFunc</span><span class="p">(</span><span class="nx">name</span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a><span class="p">,</span> <span class="nx">f</span> <a href="#HealthFunc"><span class="nx">HealthFunc</span></a><span class="p">)</span></pre>
  <p>RegisterFunc registers the health check function by the given name. If the
health check function with this name already exists, RegisterFunc panics.
<h4 id="HealthHandler.ServeHTTP">func (*HealthHandler) ServeHTTP</h4>
  <pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">h</span> <span class="o">*</span><a href="#HealthHandler"><span class="nx">HealthHandler</span></a><span class="p">)</span> <span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">w</span> <a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#ResponseWriter"><span class="nx">ResponseWriter</span></a><span class="p">,</span> <span class="nx">r</span> <span class="o">*</span><a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#Request"><span class="nx">Request</span></a><span class="p">)</span></pre>
  <p>ServeHTTP implements the http.Handler interface.
<h3 id="HealthResponse">type HealthResponse</h3>
    <pre class="chroma"><span class="kd">type</span> <span class="nx">HealthResponse</span> <span class="kd">struct</span> <span class="p">{</span>
	<span id="HealthResponse.OK"><span class="nx">OK</span></span>     <a href="https://pkg.go.dev/builtin#bool"><span class="kt">bool</span></a>                     <span class="s">`json:&#34;ok&#34;`</span>
	<span id="HealthResponse.Checks"><span class="nx">Checks</span></span> <span class="kd">map</span><span class="p">[</span><a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a><span class="p">]</span><a href="#CheckResponse"><span class="nx">CheckResponse</span></a> <span class="s">`json:&#34;checks&#34;`</span>
<span class="p">}</span></pre>
    <p>Types used in JSON responses.
<h3 id="ListenAndServeConfig">type ListenAndServeConfig</h3>
    <pre class="chroma"><span class="kd">type</span> <span class="nx">ListenAndServeConfig</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="c1">// Addr is a network address to listen on (&#39;host:port&#39; or Unix socket absolute
</span><span class="c1"></span>	<span class="c1">// path).
</span><span class="c1"></span>	<span id="ListenAndServeConfig.Addr"><span class="nx">Addr</span></span> <a href="https://pkg.go.dev/builtin#string"><span class="kt">string</span></a>
	<span class="c1">// Mux is a http.ServeMux to serve.
</span><span class="c1"></span>	<span id="ListenAndServeConfig.Mux"><span class="nx">Mux</span></span> <span class="o">*</span><a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#ServeMux"><span class="nx">ServeMux</span></a>
	<span class="c1">// Logf specifies a logger to use. If nil, log.Printf is used.
</span><span class="c1"></span>	<span id="ListenAndServeConfig.Logf"><span class="nx">Logf</span></span> <a href="../logger"><span class="nx">logger</span></a><span class="p">.</span><a href="../logger#Logf"><span class="nx">Logf</span></a>
	<span class="c1">// AfterShutdown specifies an optional callback function that is called when
</span><span class="c1"></span>	<span class="c1">// the server was shut down.
</span><span class="c1"></span>	<span id="ListenAndServeConfig.AfterShutdown"><span class="nx">AfterShutdown</span></span> <span class="kd">func</span><span class="p">()</span>
	<span class="c1">// Debuggable specifies whether to register debug handlers at /debug/.
</span><span class="c1"></span>	<span id="ListenAndServeConfig.Debuggable"><span class="nx">Debuggable</span></span> <a href="https://pkg.go.dev/builtin#bool"><span class="kt">bool</span></a>
	<span class="c1">// DebugAuth specifies an optional function that&#39;s invoked on every request to
</span><span class="c1"></span>	<span class="c1">// debug handlers at /debug/ to allow or deny access to them. If not provided,
</span><span class="c1"></span>	<span class="c1">// all access is allowed.
</span><span class="c1"></span>	<span id="ListenAndServeConfig.DebugAuth"><span class="nx">DebugAuth</span></span> <span class="kd">func</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><a href="https://pkg.go.dev/net/http"><span class="nx">http</span></a><span class="p">.</span><a href="https://pkg.go.dev/net/http#Request"><span class="nx">Request</span></a><span class="p">)</span> <a href="https://pkg.go.dev/builtin#bool"><span class="kt">bool</span></a>
<span class="p">}</span></pre>
    <p>ListenAndServeConfig is used to configure the HTTP server started by
ListenAndServe function.
</main>
    <hr>
    <footer>
      <small id="generated-by-footer">
        Generated with <a href="https://abhinav.github.io/doc2go/">doc2go</a>
      </small>
    </footer>
    <script src="../../../../_/js/permalink.js"></script></body>
</html>
